(function(t){function e(e){for(var a,r,o=e[0],c=e[1],l=e[2],h=0,d=[];h<o.length;h++)r=o[h],i[r]&&d.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(d.length)d.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},i={app:0},s=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"02b3":function(t,e,n){"use strict";var a=n("ff11"),i=n.n(a);i.a},"0adb":function(t,e,n){"use strict";var a=n("d41d"),i=n.n(a);i.a},"0bbf":function(t,e,n){},"0be8":function(t,e,n){"use strict";var a=n("0bbf"),i=n.n(a);i.a},1:function(t,e){},"13b2":function(t,e,n){"use strict";var a=n("65ef"),i=n.n(a);i.a},"245e":function(t,e,n){"use strict";var a=n("40fb"),i=n.n(a);i.a},"29f8":function(t,e,n){},3340:function(t,e,n){},"36ad":function(t,e,n){},"40fb":function(t,e,n){},5372:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("a481");var a=n("a026"),i=n("353a"),s=n.n(i),r=n("3181"),o=n.n(r);s.a.start({apiKey:"66edf57989161661871fd5c1d096ece7",plugins:[new o.a]}),s.a.getPlugin("vue").installVueErrorHandler(a["default"]);var c=n("8c4f"),l=n("5c96"),u=n.n(l),h=(n("0fae"),n("36ad"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-wrapper"},[n("div",{staticClass:"container"},[n("div",{staticClass:"header"},[n("transition",{attrs:{name:"fade"}},[n("i",{directives:[{name:"show",rawName:"v-show",value:t.showPasscode,expression:"showPasscode"}],staticClass:"el-icon-back back-to-email",on:{click:t.backToEmail}})]),t._m(0)],1),n("div",{staticClass:"form-wrapper"},[n("transition-group",{attrs:{name:t.fadeName,mode:"out-in"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.showPasscode,expression:"!showPasscode"}],key:1,staticClass:"content-wrapper"},[n("email-input",{ref:"emailInput",model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),n("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"login-button",attrs:{type:"primary",icon:"el-icon-message"},nativeOn:{click:function(e){return t.sendEmail(e)}}},[t._v("透过电邮登入")])],1),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showPasscode,expression:"showPasscode"}],key:2,staticClass:"content-wrapper"},[n("el-input",{attrs:{spellcheck:"false",placeholder:"验证码"},model:{value:t.passcode,callback:function(e){t.passcode=e},expression:"passcode"}}),n("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"login-button",attrs:{type:"primary",icon:"el-icon-message"},nativeOn:{click:function(e){return t.login(e)}}},[t._v("登入")])],1)])],1)]),n("version")],1)}),d=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",{staticClass:"title-link",attrs:{href:"https://www.getslowly.com/en/"}},[n("span",{staticClass:"title"},[t._v("Slowly")])])}];n("4917"),n("3b2b"),n("386d");function f(t){var e=/\S+@\S+\.\S+/;return e.test(t)}function p(t,e){t.$message({showClose:!0,message:e,type:"error"})}function v(t,e){t.$message({showClose:!0,message:e,type:"success"})}function m(t,e){t.$message({showClose:!0,message:e,type:"warning"})}function g(t){var e=w(t);return b(e)}function w(t){return t instanceof Date||(t=x(t)),new Date(t.getTime()-6e4*t.getTimezoneOffset())}function b(t){var e=t.getFullYear(),n=t.getDate(),a=t.getMonth()+1;n<10&&(n="0"+n),a<10&&(a="0"+a);var i=e+"-"+a+"-"+n,s=t.getHours(),r=t.getMinutes(),o=t.getSeconds();return s<10&&(s="0"+s),r<10&&(r="0"+r),o<10&&(o="0"+o),i+" "+s+":"+r+":"+o}function k(t){return"".concat(t.getFullYear(),"-").concat(t.getMonth()<9?"0":"").concat(t.getMonth()+1,"-").concat(t.getDate()<10?"0":"").concat(t.getDate())}function C(t,e){var n=864e5;return Math.round(Math.abs((t.getTime()-e.getTime())/n))}function L(t){var e,n=t.getFullYear(),a=t.getMonth()+1,i=t.getDate(),s=t.getHours(),r=t.getMinutes(),o=new Date;if(n!=(new Date).getFullYear())return"".concat(n%100,"年").concat(a,"月").concat(i,"日");a==o.getMonth()+1&&(i==o.getDate()?e="今天":i==o.getDate()-1&&(e="昨天")),e||(e="".concat(a,"月").concat(i,"日"));var c="".concat(s>12?s-12:s,":").concat(r<10?"0"+r:r);return"".concat(e," ").concat(c," ").concat(y(s))}function y(t){return 1<=t&&t<=4?"凌晨":5<=t&&t<=7?"清晨":8<=t&&t<=10?"上午":11<=t&&t<=13?"中午":14<=t&&t<=16?"下午":17<=t&&t<=18?"傍晚":19<=t&&t<=21?"晚上":"深夜"}function _(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=window.location.search,a=new RegExp("[&?]"+t+"=([^&?]*)"),i=n.match(a);return i?decodeURIComponent(i[1]):e}function x(t){var e=t.substring(5,10).replace("-","/")+"/"+t.substring(0,4)+t.substring(10);return new Date(e)}function S(t){if(!t)return 0;for(var e=0,n=!1,a=0;a<t.length;a++){var i=t.charCodeAt(a);48<=i&&i<=57||65<=i&&i<=90||97<=i&&i<=122?n=!0:(n&&(n=!1,e++),(i>=128||i<0)&&e++)}return n&&e++,e}Date.prototype.addDays=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e};var A,M,I=n("795b"),O=n.n(I),F=(n("ac6a"),n("5df3"),n("f499")),j=n.n(F),E=n("a4bb"),D=n.n(E),T=n("bc3a"),V=n.n(T),N="slowly-key-token",R="slowly-key-account";function B(){return A||(A=localStorage.getItem(N)),A}function q(t){A=t,localStorage.setItem(N,A)}function P(){if(!M){var t=localStorage.getItem(R);try{M=t?JSON.parse(t):null}catch(e){G(""),M=null}}return M}function G(t){M=t,localStorage.setItem(R,j()(t))}function Q(){q(""),G("")}var H="https://api.getslowly.com";function U(t,e){if(!e||0==D()(e).length)return t;var n="";for(var a in e)0!=n.length&&(n+="&"),n+="".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(e[a]));return"".concat(t).concat(t.indexOf("?")>=0?"&":"?").concat(n)}function W(t,e){return t||(t={}),e&&(t.token=B()),t}function X(t){var e=t.path,n=t.params,a=t.content,i=t.noAuth,s=void 0!==i&&i,r=t.headers;return V()({method:"post",url:Y({path:e,params:n,noAuth:s}),data:a,headers:r}).catch(function(t){return O.a.reject({error:t,message:$(t)})})}function z(t){var e=t.path,n=t.params,a=t.noAuth,i=void 0!==a&&a;return V.a.get(Y({path:e,params:n,noAuth:i})).catch(function(t){return O.a.reject({error:t,message:$(t)})})}function Y(t){var e=t.path,n=t.params,a=t.noAuth,i=void 0!==a&&a;return n=W(n,!i),U(H+e,n)}function $(t){return t.response&&t.response.data?t.response.data.error?t.response.data.error:j()(t.response.data):t.message?t.message:"unknown error"}n("28a5"),n("6b54");var Z=n("e814"),J=n.n(Z),K=n("85f2"),tt=n.n(K);function et(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),tt()(t,a.key,a)}}function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var i,s,r="";this.escapeRegExp=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},this.parseInt=function(t,e){return/^(-|\+)?([0-9]+|Infinity)$/.test(t)?J()(t,e):NaN},this.seps="cfhistuCFHISTU",this.minLength=0<J()(n,10)?n:0,this.salt="string"==typeof t?t:"","string"==typeof a&&(this.alphabet=a);for(var o=0;o!==this.alphabet.length;o++)-1===r.indexOf(this.alphabet.charAt(o))&&(r+=this.alphabet.charAt(o));if(this.alphabet=r,this.alphabet.length<16)throw"error: alphabet must contain at least X unique characters".replace("X",16);if(-1!==this.alphabet.search(" "))throw"error: alphabet cannot contain spaces";for(var c=0;c!==this.seps.length;c++){var l=this.alphabet.indexOf(this.seps.charAt(c));-1===l?this.seps=this.seps.substr(0,c)+" "+this.seps.substr(c+1):this.alphabet=this.alphabet.substr(0,l)+" "+this.alphabet.substr(l+1)}this.alphabet=this.alphabet.replace(/ /g,""),this.seps=this.seps.replace(/ /g,""),this.seps=this._shuffle(this.seps,this.salt),(!this.seps.length||3.5<this.alphabet.length/this.seps.length)&&(i=Math.ceil(this.alphabet.length/3.5))>this.seps.length&&(s=i-this.seps.length,this.seps+=this.alphabet.substr(0,s),this.alphabet=this.alphabet.substr(s)),this.alphabet=this._shuffle(this.alphabet,this.salt);var u=Math.ceil(this.alphabet.length/12);this.alphabet.length<3?(this.guards=this.seps.substr(0,u),this.seps=this.seps.substr(u)):(this.guards=this.alphabet.substr(0,u),this.alphabet=this.alphabet.substr(u))}var n,a;return n=e,(a=[{key:"encode",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!e.length)return"";if(e[0]&&e[0].constructor===Array&&!(e=e[0]).length)return"";for(var a=0;a!==e.length;a++)if(e[a]=this.parseInt(e[a],10),!(0<=e[a]))return"";return this._encode(e)}},{key:"decode",value:function(t){return t&&t.length&&"string"==typeof t?this._decode(t,this.alphabet):[]}},{key:"encodeHex",value:function(t){if(t=t.toString(),!/^[0-9a-fA-F]+$/.test(t))return"";for(var e=t.match(/[\w\W]{1,12}/g),n=0;n!==e.length;n++)e[n]=J()("1"+e[n],16);return this.encode.apply(this,e)}},{key:"decodeHex",value:function(t){for(var e=[],n=this.decode(t),a=0;a!==n.length;a++)e+=n[a].toString(16).substr(1);return e}},{key:"_encode",value:function(t){for(var e,n=this.alphabet,a=0,i=0;i!==t.length;i++)a+=t[i]%(i+100);for(var s=e=n.charAt(a%n.length),r=0;r!==t.length;r++){var o=t[r],c=s+this.salt+n;n=this._shuffle(n,c.substr(0,n.length));var l=this._toAlphabet(o,n);if(e+=l,r+1<t.length){var u=(o%=l.charCodeAt(0)+r)%this.seps.length;e+=this.seps.charAt(u)}}if(e.length<this.minLength){var h=(a+e[0].charCodeAt(0))%this.guards.length,d=this.guards[h];(e=d+e).length<this.minLength&&(h=(a+e[2].charCodeAt(0))%this.guards.length,e+=d=this.guards[h])}for(var f=J()(n.length/2,10);e.length<this.minLength;){var p=(e=(n=this._shuffle(n,n)).substr(f)+e+n.substr(0,f)).length-this.minLength;0<p&&(e=e.substr(p/2,this.minLength))}return e}},{key:"_decode",value:function(t,e){var n=[],a=0,i=new RegExp("[".concat(this.escapeRegExp(this.guards),"]"),"g"),s=t.replace(i," "),r=s.split(" ");if(3!==r.length&&2!==r.length||(a=1),void 0!==(s=r[a])[0]){var o=s[0];s=s.substr(1),i=new RegExp("[".concat(this.escapeRegExp(this.seps),"]"),"g"),r=(s=s.replace(i," ")).split(" ");for(var c=0;c!==r.length;c++){var l=r[c],u=o+this.salt+e;e=this._shuffle(e,u.substr(0,e.length)),n.push(this._fromAlphabet(l,e))}this.encode(n)!==t&&(n=[])}return n}},{key:"_shuffle",value:function(t,e){var n;if(!e.length)return t;for(var a=(t=t.split("")).length-1,i=0,s=0,r=0;0<a;a--,i++){i%=e.length,s+=n=e.charCodeAt(i);var o=t[r=(n+i+s)%a];t[r]=t[a],t[a]=o}return t.join("")}},{key:"_toAlphabet",value:function(t,e){for(var n="";n=e.charAt(t%e.length)+n,t=J()(t/e.length,10););return n}},{key:"_fromAlphabet",value:function(t,e){return t.split("").map(function(t){return e.indexOf(t)}).reduce(function(t,n){return t*e.length+n},0)}}])&&t(n.prototype,a),e}function nt(t,e){var n=et();return new n("+DP;=SW`DGX&n|]OGoGkj/4XqPw?^Fclc2F-_V~D=rquG+L(kW_xzVR=slp+Yj;B",30).encode(J()(t),J()(e||0),Math.floor(1e5+9e5*Math.random()))}function at(t){return X({path:"/auth/email/passcode",noAuth:!0,content:{email:t,device:"web"}})}function it(t,e){return X({path:"/auth/email",noAuth:!0,content:{email:t,device:"web",passcode:e}})}function st(){return z({path:"/users/me/friends/v2",params:{requests:1}})}function rt(t,e){return z({path:"/posts/".concat(t),params:{ver:2,page:e}})}function ot(t){return gt({params:{}})}function ct(t,e,n,a){return X({path:"/posts/".concat(t,"/reply"),content:{body:e,attachments:a,style:{},stamp:"free",host:n}})}function lt(t,e){return ut(t,e).then(function(n){return gt({content:{language:null,location:"".concat(t,",").concat(e),location_code:n,device:"web",ver:30200,includes:null}})})}function ut(t,e){return X({path:"/geocode",content:{lat:t,lng:e}}).then(function(t){return t.data[0].properties.countryCode})}function ht(t){return Y({path:"/attachments/".concat(t)})}function dt(t){return Y({path:"/attachments",params:{post:t}})}function ft(t,e){return O.a.all(e.map(function(e){return pt(t,e)}))}function pt(t,e){var n=new FormData;return n.append("image",e),X({path:"/attachments",params:{post:t},content:n})}function vt(t){return X({path:"/comments/read",params:{ids:t}})}function mt(){return z({path:"/timestamp"})}function gt(t){var e=t.params,n=t.content;return mt().then(function(t){var a=t.data.now,i=P(),s=nt(a,i&&i.id);return e?e.otp=s:n&&(n.otp=s),X({path:"/users/me/v2",content:n,params:e})})}var wt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-popover",{attrs:{placement:"bottom","popper-class":"email-popover",width:"50%",trigger:"manual"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[n("div",t._l(t.cachedEmails,function(e){return n("div",{key:e,staticClass:"item",on:{click:function(n){return t.checkEmail(e)}}},[n("el-row",{attrs:{type:"flex"}},[n("el-col",{attrs:{span:20}},[t._v(t._s(e))]),n("el-col",{staticClass:"el-remove-email",attrs:{span:4,title:"删除"},nativeOn:{click:function(n){return n.stopPropagation(),t.removeEmail(e)}}},[n("i",{staticClass:"el-icon-delete"})])],1)],1)}),0),n("el-input",{attrs:{slot:"reference",value:t.value,spellcheck:"false",clearable:!0,placeholder:"电邮"},on:{input:function(e){return t.$emit("input",e)}},slot:"reference"})],1)],1)},bt=[],kt={data:function(){return{visible:!1,cachedEmails:[]}},props:{value:{type:String,required:!0}},watch:{value:function(){this.setPopupState()}},methods:{save:function(t){t||(t=this.value);var e=this.loadEmails().filter(function(e){return e!=t});e.splice(0,0,t),this.saveEmails(e)},loadEmails:function(){return JSON.parse(localStorage.getItem("email-cache-json")||"[]")||[]},saveEmails:function(t){localStorage.setItem("email-cache-json",j()(t))},checkEmail:function(t){var e=this;this.$emit("input",t),this.$nextTick(function(){e.visible=!1})},removeEmail:function(t){this.saveEmails(this.loadEmails().filter(function(e){return e!=t})),this.setPopupState()},setPopupState:function(){var t=this;this.cachedEmails=this.loadEmails().filter(function(e){return e.indexOf(t.value)>=0}),this.visible=!!(this.value&&this.cachedEmails.length>0)}},mounted:function(){var t=this.loadEmails();t.length>0&&this.checkEmail(t[0])}},Ct=kt,Lt=(n("eb33"),n("2877")),yt=Object(Lt["a"])(Ct,wt,bt,!1,null,null,null),_t=yt.exports,xt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.newVersion?n("div",{staticClass:"new-version",on:{click:function(e){return t.updateNewVersion()}}},[n("div",[t._v("点击更新")]),t.newVersion.content&&t.newVersion.content.length>0?n("ul",t._l(t.newVersion.content,function(e){return n("li",{key:e},[n("span",[t._v(t._s(e))])])}),0):t._e()]):t._e()},St=[],At=n("cebc"),Mt=n("2f62"),It=n("0a0d"),Ot=n.n(It),Ft={versionName:"2.0.4",versionCode:48,content:["修复无法更新位置问题"]};window.appVersion={versionName:"2.0.4",versionCode:48,content:["修复无法更新位置问题"]};var jt="key_url_timestamp",Et="t";function Dt(t){return t&&t.length>0&&t.forEach(function(t){t.contentItems="string"===typeof t.content?t.content.split("\n"):t.content}),t}function Tt(){return new O.a(function(t,e){V()({method:"get",url:"./change-log.json?t=".concat(Ot()())}).then(function(e){if(e.data&&e.data.length>0){Dt(e.data);var n=e.data[0];t({newVersion:n&&n.versionCode>Ft.versionCode?{content:n.contentItems}:null,changeLog:e.data})}else t(!1)}).catch(function(e){t(!1)})})}function Vt(t){var e=window.location,n="".concat(Et,"=").concat(t);if(e.search){var a=e.search.match(new RegExp("[&?](".concat(Et,"=[^&?]*)")));n=a?e.search.replace(a[1],n):e.search+"&"+n}else n="?"+n;return e.origin+e.pathname+n+e.hash}function Nt(t){localStorage.setItem(jt,t),window.location.href=Vt(t)}function Rt(){Nt(Ot()())}function Bt(){var t=localStorage.getItem(jt);"null"==t&&(localStorage.removeItem(jt),t=null);var e=_(Et);if(t){if(!e||e<t)return Nt(t),!0}else e&&localStorage.setItem(jt,e);return!1}var qt={data:function(){return{newVersion:!1}},methods:Object(At["a"])({},Object(Mt["b"])(["setChangeLog"]),{updateNewVersion:function(){Rt()}}),mounted:function(){var t=this;Tt().then(function(e){e&&(e.newVersion&&(t.newVersion=e.newVersion),t.setChangeLog(e.changeLog))})}},Pt=qt,Gt=(n("d6de"),Object(Lt["a"])(Pt,xt,St,!1,null,"5813b4df",null)),Qt=Gt.exports,Ht={data:function(){return{email:"",passcode:"",fullscreenLoading:!1,showPasscode:!1}},components:{EmailInput:_t,Version:Qt},computed:{fadeName:function(){return this.showPasscode?"slide-in":"slide-out"}},methods:{sendEmail:function(){var t=this;f(this.email)?(this.fullscreenLoading=!0,at(this.email).then(function(e){t.fullscreenLoading=!1,e&&e.data&&e.data.success&&(v(t,"验证码已发送至".concat(t.email)),t.showPasscode=!0,t.$refs.emailInput.save())}).catch(function(e){t.fullscreenLoading=!1,t.$errorHandler(e)})):p(this,"请输入正确的邮箱格式")},login:function(){var t=this;this.passcode?(this.fullscreenLoading=!0,it(this.email,this.passcode).then(function(e){t.fullscreenLoading=!1,e&&e.data&&e.data.token&&(q(e.data.token),t.$router.replace({name:"home"}))}).catch(function(e){t.fullscreenLoading=!1,t.$errorHandler(e)})):p(this,"请输入验证码")},backToEmail:function(){this.showPasscode=!1}},mounted:function(){B()&&this.$router.replace({name:"home"})}},Ut=Ht,Wt=(n("9ded"),Object(Lt["a"])(Ut,h,d,!1,null,"3cbca486",null)),Xt=Wt.exports,zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container",class:{"mobile-mode":t.mobileMode}},[t.accountInfo?t._e():a("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.accountInfo,expression:"!accountInfo"}],attrs:{id:"account-loading","element-loading-text":"加载个人信息..."}}),a("div",{staticClass:"nav-header"},[a("img",{staticClass:"logo",attrs:{src:n("f182")}}),a("span",{staticClass:"title"},[t._v("Slowly")]),a("div",{staticClass:"middle"},[t.checkedFriend?a("input-box"):t._e()],1),a("el-dropdown",{staticClass:"menu-more",attrs:{trigger:"click"}},[a("i",{staticClass:"el-icon-more"}),t._v("`\n      "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(e){return t.editLocation(e)}}},[t._v("修改位置")]),a("el-dropdown-item",{nativeOn:{click:function(e){return t.showAbout(e)}}},[t._v("关于")]),a("el-dropdown-item",{nativeOn:{click:function(e){return t.showChangeLog(e)}}},[t._v("更新内容")]),a("el-dropdown-item",{nativeOn:{click:function(e){return t.exit(e)}}},[t._v("退出")])],1)],1)],1),a("div",{staticClass:"main-content"},[a("div",{staticClass:"left-section",class:{"left-section-exited":t.leftSectionExited}},[t.mobileMode?a("div",{staticClass:"sidebar-header"},[a("i",{staticClass:"icon-nav",class:{"el-icon-arrow-right":t.leftSectionExited,"el-icon-arrow-left":!t.leftSectionExited},on:{click:function(e){t.leftSectionExited=!t.leftSectionExited}}})]):t._e(),a("div",{staticClass:"sidebar-content soft-scrollable"},[a("friends",{attrs:{isExpand:!t.leftSectionExited}})],1)]),a("div",{staticClass:"left-section-overlay",class:{entered:t.mobileMode&&!t.leftSectionExited},on:{click:function(e){t.leftSectionExited=!0}}}),a("div",{staticClass:"right-section"},[a("letters",{directives:[{name:"show",rawName:"v-show",value:t.checkedFriend,expression:"checkedFriend"}],on:{showMap:function(e){return t.showMap(e)}}}),a("quote-node",{directives:[{name:"show",rawName:"v-show",value:!t.checkedFriend,expression:"!checkedFriend"}]})],1)]),a("version"),a("map-node",{ref:"map"}),a("about",{ref:"about"}),a("change-log",{ref:"changeLog"})],1)},Yt=[],$t=n("a745"),Zt=n.n($t),Jt=(n("96cf"),n("3b8d")),Kt=n("7618"),te=1,ee="friends",ne="letters",ae="draft";function ie(t){var e=t.target.result;t.oldVersion<1&&(se(e,ee,"user_id"),se(e,ne,"id",{owner_id:!1}),se(e,ae,"user_id"))}function se(t,e,n,a){if(t.objectStoreNames.contains(e))return!1;var i=n?t.createObjectStore(e,{keyPath:n}):t.createObjectStore(e,{autoIncrement:!0});if(a&&"object"==Object(Kt["a"])(a))for(var s in a)a.hasOwnProperty(s)&&i.createIndex(s,s,{unique:!!a[s]})}var re=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,oe=null;function ce(){var t=P();return t?"".concat(t.id,"-slowly"):"slowly"}function le(){return new O.a(function(t,e){ue();var n=re.open(ce(),te);n.onupgradeneeded=ie,n.onerror=function(t){oe=null,e(t.target.error)},n.onsuccess=function(e){oe=e.target.result,t(oe)}})}function ue(){oe&&(oe.close(),oe=null)}function he(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new O.a(function(){var n=Object(Jt["a"])(regeneratorRuntime.mark(function n(a,i){var s,r,o;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,le();case 3:s=oe.transaction([t],"readonly"),r=s.objectStore(t),o=e?r.get(e):r.getAll(),o.onsuccess=function(t){a(t.target.result)},o.onerror=function(t){i(t.target.error)},n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](0),i(n.t0);case 13:case"end":return n.stop()}},n,null,[[0,10]])}));return function(t,e){return n.apply(this,arguments)}}())}function de(t,e,n){return new O.a(function(){var a=Object(Jt["a"])(regeneratorRuntime.mark(function a(i,s){var r,o,c,l;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,le();case 3:r=oe.transaction([t],"readonly"),o=r.objectStore(t),c=o.index(e),l=c.getAll(n),l.onsuccess=function(t){i(t.target.result)},l.onerror=function(t){s(t.target.error)},a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](0),s(a.t0);case 14:case"end":return a.stop()}},a,null,[[0,11]])}));return function(t,e){return a.apply(this,arguments)}}())}function fe(t){return Zt()(t)?t:[t]}function pe(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e=fe(e),new O.a(function(){var n=Object(Jt["a"])(regeneratorRuntime.mark(function n(a,i){var s,r;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,le();case 3:s=oe.transaction([t],"readwrite"),r=s.objectStore(t),e.forEach(function(t){r.add(t)}),s.oncomplete=function(t){a(t.target.result)},s.onerror=function(t){i(t.target.error)},n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](0),i(n.t0);case 13:case"end":return n.stop()}},n,null,[[0,10]])}));return function(t,e){return n.apply(this,arguments)}}())}function ve(t,e,n){return new O.a(function(){var a=Object(Jt["a"])(regeneratorRuntime.mark(function a(i,s){var r,o,c;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,le();case 3:r=oe.transaction([t],"readwrite"),o=r.objectStore(t),r.oncomplete=function(t){i(t.target.result)},r.onerror=function(t){s(t.target.error)},c=o.openCursor(n),c.onsuccess=function(t){var n=t.target.result;n?n.update(e):o.add(e)},a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](0),s(a.t0);case 14:case"end":return a.stop()}},a,null,[[0,11]])}));return function(t,e){return a.apply(this,arguments)}}())}function me(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e=fe(e),new O.a(function(){var a=Object(Jt["a"])(regeneratorRuntime.mark(function a(i,s){var r,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,le();case 3:r=oe.transaction([t],"readwrite"),o=r.objectStore(t),r.oncomplete=function(t){i(t.target.result)},r.onerror=function(t){s(t.target.error)},e.forEach(function(t){o.delete(n?t[n]:t)}),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),s(a.t0);case 13:case"end":return a.stop()}},a,null,[[0,10]])}));return function(t,e){return a.apply(this,arguments)}}())}function ge(t){return new O.a(function(){var e=Object(Jt["a"])(regeneratorRuntime.mark(function e(n,a){var i,s,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,le();case 3:i=oe.transaction([t],"readwrite"),s=i.objectStore(t),r=s.clear(),r.onsuccess=function(t){n(t.target.readyState)},r.onerror=function(t){a(t.target.error)},e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),a(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t,n){return e.apply(this,arguments)}}())}function we(){return he(ee)}function be(t){return ge(ee).then(function(){return pe(ee,t)})}n("55dd");var ke=n("75fc"),Ce=n("d225"),Le=n("b0b4"),ye=0,_e=1,xe=2,Se=3,Ae=4,Me=5,Ie=function(){function t(e){Object(Ce["a"])(this,t),this.friend=e,this.userId=e.id,this.syncPage=1,this.syncState=ye,this.dataList=[],this.syncDataList=[]}return Object(Le["a"])(t,[{key:"setCallback",value:function(t){return this.callback=t,this}},{key:"doCallback",value:function(){this.callback&&this.callback(this,{isRefresh:this.syncState==Se,isSync:this.syncState==xe,isSuccess:this.syncState==Ae,dataList:this.dataList})}},{key:"requestData",value:function(){var t=this;this.syncState>ye&&this.syncState<Ae?this.doCallback():(this.syncState=_e,this.syncPage=1,this.dataList=[],this.syncDataList=[],je(this.userId).then(function(e){if(e&&0!=e.length){t.dataList=t.sortList(e);var n=window.__CONFIG__.useCache||t.friend.lastRefreshTime&&Ot()()-t.friend.lastRefreshTime<6e5;n?(t.syncState=Ae,t.doCallback()):(t.syncState=Se,t.doCallback(),t.loadServerLetters(1))}else t.syncState=xe,t.doCallback(),t.loadServerLetters(t.syncPage)}).catch(function(t){console.error(t)}))}},{key:"bindThis",value:function(t){return t.bind(this)}},{key:"loadServerLetters",value:function(t){var e=this;rt(this.userId,t).then(this.getResultHandler(t)).catch(function(t){console.error(t),e.syncState=Me,e.doCallback()})}},{key:"getResultHandler",value:function(t){function e(e){var n=this,i=e.data;i.user&&a["default"].set(this.friend,"last_login",i.user.last_login);var s,r=this.sortList(i.comments.data||[]),o=!!i.comments.next_page_url;if(this.syncState==Se){var c=this.subListTo(r,this.dataList[0]);c<0?this.syncState=xe:(this.updateLetters(r),this.friend.lastRefreshTime=Ot()(),this.syncState=Ae,je(this.userId).then(function(t){n.dataList=n.sortList(t),n.doCallback()}))}this.syncState==xe&&((s=this.syncDataList).push.apply(s,Object(ke["a"])(r)),o?(this.syncPage=t+1,this.loadServerLetters(this.syncPage),this.doCallback()):(this.syncState=Ae,this.dataList=this.sortList(this.syncDataList),me(ne,this.syncDataList,"id"),this.insertLetters(this.dataList),this.doCallback()))}return e.bind(this)}},{key:"subListTo",value:function(t,e){for(var n=0;n<t.length;n++)if(t[n].id==e.id)return n;return-1}},{key:"sortList",value:function(t){return t.sort(function(t,e){return e.id-t.id}),t}},{key:"clearLetters",value:function(t){return me(ne,t,"letter_id")}},{key:"insertLetters",value:function(t){var e=this;return t.forEach(function(t){t.owner_id=e.userId}),pe(ne,t)}},{key:"updateLetters",value:function(t){var e=this;t.forEach(function(t){t.owner_id=e.userId,ve(ne,t,t.id)})}}]),t}(),Oe={};function Fe(t){return Oe[t.id]||(Oe[t.id]=new Ie(t)),Oe[t.id]}function je(t){return de(ne,"owner_id",t)}n("7f7f");function Ee(t){return t=t||[],t.sort(function(t,e){return t.latest_comment?e.latest_comment?-t.latest_comment.localeCompare(e.latest_comment):-1:1}),t}function De(t,e){t.$nextTick(function(){var n=t.$el.querySelector(e);n&&(n.scrollTop=0)})}function Te(t,e){var n=-1,a=setInterval(function(){n>=t.scrollTop?(e&&e(),clearInterval(a)):n=t.scrollTop},20)}function Ve(t,e){var n=new Blob([(e||[]).map(function(t){return Ne(t)}).join("\n\n\n\n")],{type:"text/plain"}),a=document.createElement("a"),i=URL.createObjectURL(n);a.href=i,a.download="".concat(t.name,".txt"),document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(i)},0)}function Ne(t){var e=t.body;return e+="\n发信人：".concat(t.name),e+="\n字数：".concat(t.body.length),e+="\n发送时间：".concat(g(t.created_at)),t.read_at&&(e+="\n阅读时间：".concat(g(t.read_at))),e}function Re(t){var e=t.preloadCount,n=void 0===e?5:e,a=t.dataList,i=void 0===a?[]:a;function s(){this.fastRender=!1,this.dataList=i,this.preloadCount=n}return s.prototype={optimise:function(){var t=this;this.fastRender=!0,setTimeout(function(){t.fastRender=!1},0)},renderedList:function(){return this.fastRender?this.dataList.slice(0,this.preloadCount):this.dataList}},new s}var Be=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.friendList,function(e){return n("div",{key:e.user_id,staticClass:"friend-item",class:{checked:e==t.checkedFriend},on:{click:function(n){return t.checkFriend(e)}}},[t.isExpand?[t._v("\n      "+t._s(e.name)+"\n    ")]:[n("div",{staticClass:"header"},[t._v(t._s(e.name.length>0&&e.name[0]))])]],2)}),0)},qe=[],Pe={computed:Object(At["a"])({},Object(Mt["c"])(["checkedFriend","friendList"])),methods:Object(At["a"])({},Object(Mt["b"])(["checkFriend"])),props:{isExpand:!1}},Ge=Pe,Qe=(n("9ce7"),Object(Lt["a"])(Ge,Be,qe,!1,null,"e65a9c78",null)),He=Qe.exports,Ue=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.checkedFriend?a("el-row",{staticClass:"component-wrapper",class:{"mobile-mode":t.mobileMode}},[a("el-col",{staticClass:"left-section",attrs:{span:t.checkedLetter?12:24}},[a("div",{staticClass:"letter-list soft-scrollable"},t._l(t.renderLetters,function(e,i){return a("div",{key:e.id,staticClass:"letter-item",class:{"letter-checked":e==t.checkedLetter,"letter-highlight":t.highlightDate&&e.highlight},on:{click:function(n){return t.checkLetter(e,i)}}},[a("div",{staticClass:"letter-item-content"},[a("div",[t._v("\n            "+t._s(e.name)+"\n            "),a("span",{staticClass:"letter-state"},[t.isLetterArrive(e)?a("span",{staticClass:"letter-deliver-time"},[a("span",[t._v(t._s(t.formatReadableTime(e.created_at)))]),e.read_at?t._e():a("span",{staticClass:"letter-read-state"})]):a("img",{staticClass:"letter-in-out",attrs:{src:t.isLetterOut(e)?t.icLetterInOut[1]:t.icLetterInOut[0]}})])]),a("div",{staticClass:"letter-body"},[t.searchValue?a("span",{staticClass:"letter-content",domProps:{innerHTML:t._s(e.searchHtml)}}):a("span",{staticClass:"letter-content"},[t._v(t._s(e.body.substring(0,150)))]),a("img",{directives:[{name:"show",rawName:"v-show",value:e.attachments&&t.isLetterArrive(e),expression:"letter.attachments && isLetterArrive(letter)"}],staticClass:"letter-attacments",attrs:{src:n("b84f")}})])])])}),0),a("div",{staticClass:"friend-info"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.searchValue,expression:"!searchValue"}],staticClass:"friendinfo-header"},[a("div",{staticClass:"left-container"},[a("div",{staticClass:"content"},[a("span",{staticClass:"name",attrs:{title:t.checkedFriendInfo},on:{click:t.showFriendInfo}},[t._v(t._s(t.checkedFriend.name)),a("span",{attrs:{title:"信件数量"}},[t._v("("+t._s(t.searchValue?t.renderLetters.length:t.letters.length)+")")])]),a("i",{directives:[{name:"show",rawName:"v-show",value:t.checkedFriend.user_location,expression:"checkedFriend.user_location"}],staticClass:"el-icon-location",attrs:{title:"查看位置"},on:{click:function(e){return t.$emit("showMap",t.checkedFriend)}}}),a("i",{staticClass:"el-icon-date",attrs:{title:"统计"},on:{click:t.showStat}}),a("i",{staticClass:"el-icon-plus",attrs:{title:"新建"},on:{click:t.newLetter}}),a("i",{staticClass:"el-icon-download",attrs:{title:"导出信件"},on:{click:t.doExport}})])]),a("div",{staticClass:"right-container"},[a("i",{directives:[{name:"show",rawName:"v-show",value:t.showSyncIcon,expression:"showSyncIcon"}],staticClass:"el-icon-loading"}),a("span",{directives:[{name:"show",rawName:"v-show",value:t.letterState,expression:"letterState"}],staticClass:"sync-state"},[t._v(t._s(t.letterState))]),a("i",{staticClass:"el-icon-close btn-close-letter",on:{click:t.closeLetters}})])]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.searchValue,expression:"searchValue"}]},[a("span",{staticClass:"name"},[t._v('搜索"'+t._s(t.searchValue)+'"('+t._s(t.renderLetters.length)+")")])])])]),t.checkedLetter?a("el-col",{staticClass:"right-section",attrs:{span:12}},[t._e(),a("div",{staticClass:"scroll-container-wrapper"},[a("div",{staticClass:"scroll-container soft-scrollable"},[a("letter-item",{ref:"letterItem",attrs:{letter:t.checkedLetter}})],1),a("div",{staticClass:"letter-nav"},[a("span",{staticClass:"last-letter",style:{opacity:this.checkedLetterIndex>0?1:0},on:{click:t.lastLetter}},[t._v("上一封")]),a("span",{staticClass:"next-letter",style:{opacity:this.checkedLetterIndex<this.renderLetters.length-1?1:0},on:{click:t.nextLetter}},[t._v("下一封")]),a("i",{staticClass:"el-icon-close btn-close-letter",on:{click:function(e){t.checkedLetter=null}}})])])]):t._e(),a("new-letter",{ref:"newLetter",on:{sendSuccess:function(e){return t.loadLetters(t.checkedFriend)}}}),a("stat",{ref:"stat",on:{scrollToDate:function(e){return t.scrollToDate(e)}}})],1):t._e()},We=[],Xe=n("b1cc"),ze=n.n(Xe),Ye=n("a9b7"),$e=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.editorVisible?n("div",{staticClass:"modal"},[n("div",{staticClass:"editor-wrapper",class:{large:t.isShowLetter}},[n("div",{staticClass:"editor-header"},[n("span",[t._v("To "+t._s(t.checkedFriend&&t.checkedFriend.name))]),n("span",{directives:[{name:"show",rawName:"v-show",value:t.wordCount,expression:"wordCount"}],staticClass:"word-count"},[t._v(t._s(t.wordCount))]),n("span",{directives:[{name:"show",rawName:"v-show",value:t.letterState,expression:"letterState"}],staticClass:"sending-state"},[t._v(t._s(t.letterState))]),n("span",{staticClass:"el-icon-close",attrs:{title:"关闭"},on:{click:function(e){return t.close()}}}),n("span",{staticClass:"el-icon-tickets",attrs:{title:"历史信件"},on:{click:function(e){return t.toggleShowLetter()}}}),n("span",{staticClass:"el-icon-message",attrs:{title:"发送"},on:{click:function(e){return t.send()}}})]),n("el-row",{staticClass:"editor-content"},[n("el-col",{staticClass:"editor-left-section",attrs:{span:t.isShowLetter?12:24}},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputData,expression:"inputData"}],staticClass:"editor-body",attrs:{name:"text",placeholder:"请写下文字",spellcheck:"false",oninput:'this.style.height = "";this.style.height = this.scrollHeight + "px"'},domProps:{value:t.inputData},on:{input:function(e){e.target.composing||(t.inputData=e.target.value)}}}),n("div",{staticClass:"form-section"},[n("form",{staticStyle:{width:"0",height:"0"},attrs:{id:"formSumbit",action:t.formUploadUrl(),method:"post",enctype:"multipart/form-data"}},[n("input",{staticStyle:{width:"0",height:"0"},attrs:{type:"file",id:"input-image",name:"image",multiple:"",accept:"image/png, image/jpeg"},on:{change:function(e){return t.onImageChange()}}})]),n("div",{staticClass:"tip-add-image",on:{click:function(e){t.isShowAddMedia=!t.isShowAddMedia}}},[n("span",{directives:[{name:"show",rawName:"v-show",value:t.mobileMode&&!t.isShowAddMedia,expression:"mobileMode && !isShowAddMedia"}]},[t._v("点击")]),t._v("添加图片"),n("span",{directives:[{name:"show",rawName:"v-show",value:t.rawImageList.length,expression:"rawImageList.length"}]},[t._v("("+t._s(t.rawImageList.length)+")")])]),!t.mobileMode||t.isShowAddMedia?n("div",{staticClass:"image-container"},[n("div",{staticClass:"btn-add-image",on:{click:function(e){return t.addImage()}}},[n("i",{staticClass:"el-icon-plus"})]),t._l(t.rawImageList,function(e,a){return n("div",{key:e.key,staticClass:"image-item"},[n("img",{attrs:{src:e.src},on:{click:function(n){return t.viewImage(e.src)}}}),n("i",{staticClass:"el-icon-remove",on:{click:function(e){return t.removeImage(a)}}})])})],2):t._e()])]),t.isShowLetter&&t.checkedFriend.letters?n("el-col",{staticClass:"edit-letter-list soft-scrollable",attrs:{span:12}},t._l(t.renderLetters,function(t){return n("letter-item",{key:t.id,attrs:{dialogMode:!0,letter:t}})}),1):t._e()],1)],1)]):t._e()},Ze=[];function Je(t){return he(ae,t)}function Ke(t){return null==t.user_id?O.a.reject("draft must contains field user_id"):ve(ae,t,t.user_id)}var tn,en,nn=n("5118"),an=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.letter?a("div",{staticClass:"letter-detail-wrapper"},[a("div",{staticClass:"letter-detail",class:{"dialog-mode":t.dialogMode}},[a("img",{attrs:{src:n("aeb8"),alt:""}}),a("div",{domProps:{innerHTML:t._s(t.highlightBody(t.letter))}}),t.attachments?a("div",{staticClass:"attachments"},[a("grid-view",{attrs:{numColumns:t.attachments.length>2?3:2,spaceX:10,spaceY:10}},t._l(t.attachments,function(t){return a("a",{directives:[{name:"lazy",rawName:"v-lazy:background-image",value:t,expression:"url",arg:"background-image"}],key:t,attrs:{href:t,target:"_blank"}})}),0)],1):t._e()]),t.letter?a("div",{staticClass:"letter-info"},[a("div",[a("span",{staticClass:"title-label"},[t._v("字数")]),t._v(t._s(t.wordCount))]),a("div",[a("span",{staticClass:"title-label"},[t._v("发信人")]),t._v(t._s(t.letter.name))]),a("div",[a("span",{staticClass:"title-label"},[t._v("发送时间")]),t._v(t._s(t.formatTime(t.letter.created_at)))]),a("div",[a("span",{staticClass:"title-label"},[t._v("送达时间")]),t._v(t._s(t.formatTime(t.letter.deliver_at)))]),t.letter.read_at?a("div",[a("span",{staticClass:"title-label"},[t._v("阅读时间")]),t._v(t._s(t.formatTime(t.letter.read_at)))]):t._e()]):t._e()]):t._e()},sn=[],rn=(n("c5f6"),n("4aa6")),on=n.n(rn),cn={data:function(){return{width:0}},methods:{getPadding:function(){if(!this.$el||!this.$el.nodeType)return 0;var t=window.getComputedStyle(this.$el,null);function e(e){var n=t?J()(t.getPropertyValue("padding-"+e)):0;return n>=0?n:0}return e("left")+e("right")}},render:function(t){if(this.$el&&this.$el.offsetWidth>0&&(this.width=this.$el.offsetWidth),0==this.width)return t("div",{class:"grid-view"},[]);for(var e=this.width-this.getPadding()-1,n=Math.floor((e+this.spaceX)/this.numColumns)-this.spaceX,a=this.$slots.default&&this.$slots.default.filter(function(t){return null!=t.tag})||[],i=a.length,s=0;s<i;s++){var r=a[s],o="".concat(s%this.numColumns==0?0:this.spaceX,"px"),c="".concat(0==J()(s/this.numColumns)?0:this.spaceY,"px"),l="".concat(n,"px");if(!r.data||!r.data.style||r.data.style["margin-left"]!=o||r.data.style.width!=l){r.data=on()(r.data||{});var u=r.data.staticStyle=on()(r.data.staticStyle||{});u.width=l;var h=this.getChildHeight(n);u.height="string"==typeof h?h:h+"px",u["margin-left"]=o,u["margin-top"]=c,r.data["class"]?r.data["class"].indexOf("child")<0&&(r.data["class"]+=" child"):r.data.class="child"}}return t("div",{class:"grid-view"},a)},mounted:function(){var t=this;this.width=this.$el.offsetWidth||0,this.$nextTick(function(){t._watchers&&t._watchers.forEach(function(t){return t.update()})})},created:function(){0==this.numColumns&&(this.numColumns=3)},props:{numColumns:{type:Number,default:0},spaceX:{type:Number,default:0},spaceY:{type:Number,default:0},getChildHeight:{type:Function,default:function(t){return t}}}},ln=cn,un=(n("a39b"),Object(Lt["a"])(ln,tn,en,!1,null,"d5bfb6b4",null)),hn=un.exports,dn={components:{GridView:hn},props:{letter:{type:Object,required:!0},dialogMode:{type:Boolean,default:function(){return!1}}},computed:Object(At["a"])({},Object(Mt["c"])(["checkedFriend","searchValue"]),{attachments:function(){var t=this.letter;return t&&t.attachments?t.attachments.split(",").map(function(t){return ht(t)}):null},wordCount:function(){return S(this.letter.body)}}),methods:{formatTime:function(t){return g(t)},highlightBody:function(t){var e=t.body&&t.body.trim()||"";return this.searchValue?e.split(this.searchValue).join('<span class="highlight">'+this.searchValue+"</span>"):e}}},fn=dn,pn=(n("02b3"),n("675e"),Object(Lt["a"])(fn,an,sn,!1,null,"0e4b4928",null)),vn=pn.exports,mn={data:function(){return{editorVisible:!1,inputData:"",isSending:!1,isUploading:!1,isShowLetter:!1,rawImageList:[],attachments:"",isAutoSaving:!1,listRender:Re({preloadCount:5}),isShowAddMedia:!1}},components:{LetterItem:vn,GridView:hn},computed:Object(At["a"])({},Object(Mt["c"])(["checkedFriend","mobileMode"]),{renderLetters:function(){return this.listRender.renderedList()},letterState:function(){return this.isSending||this.isUploading||this.isAutoSaving?this.isUploading?"正在上传图片...":this.isSending?"正在发送...":"正在保存草稿...":""},wordCount:function(){return S(this.inputData)}}),watch:{editorVisible:function(t){t?(this.listRender.optimise(),this.scrollLetterListToTop()):this.intervalId&&(Object(nn["clearInterval"])(this.intervalId),this.intervalId=null)},checkedFriend:function(t){t&&(this.listRender.dataList=t.letters||[])},inputData:function(){this.contentHasChanged=!0}},methods:{formUploadUrl:function(){return dt(this.checkedFriend.id)},showEditor:function(){var t=this;this.editorVisible=!0,this.inputData="",this.isSending=!1,this.isUploading=!1,this.rawImageList=[],Je(this.checkedFriend.id).then(function(e){e&&(t.inputData=e.content)}).catch(function(e){return p(t,"加载草稿失败："+e)}),this.intervalId=Object(nn["setInterval"])(function(){t.contentHasChanged&&(t.saveDraft(t.inputData),t.contentHasChanged=!1,t.isAutoSaving=!0,Object(nn["setTimeout"])(function(){t.isAutoSaving=!1},2e3))},15e3)},saveDraft:function(t){var e=this;return Ke({user_id:this.checkedFriend.id,content:t}).catch(function(t){return p(e,"保存草稿失败："+t)})},close:function(){var t=this;this.inputData?this.$confirm("关闭后将会保存为草稿，".concat(this.rawImageList.length>0?"但图片会丢失，":"","是否关闭？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){t.saveDraft(t.inputData).then(function(){t.editorVisible=!1})}).catch(function(){}):this.editorVisible=!1},send:function(){var t=this;this.inputData?this.$confirm("是否发送给".concat(this.checkedFriend.name,"？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){t.rawImageList.length>0?t.uploadImages():t.sendImpl()}).catch(function(){}):p(this,"请输入内容")},sendImpl:function(){var t=this;this.isSending=!0;var e=P();ct(this.checkedFriend.id,this.inputData,this.checkedFriend.joined!=e.id,this.attachments).then(function(e){t.editorVisible=!1,t.isSending=!1,t.checkedFriend.lastRefreshTime=0,t.$emit("sendSuccess"),t.saveDraft(""),v(t,"success")}).catch(function(e){var n=e.message;t.isSending=!1,p(t,n)})},toggleShowLetter:function(){this.isShowLetter=!this.isShowLetter,this.isShowLetter&&this.checkedFriend&&(this.listRender.dataList=this.checkedFriend.letters||[]),this.listRender.optimise(),this.scrollLetterListToTop()},scrollLetterListToTop:function(){this.isShowLetter&&De(this,".edit-letter-list")},addImage:function(){this.$el.querySelector("#input-image").click()},onImageChange:function(){for(var t=this.$el.querySelector("#input-image").files||[],e=0;e<t.length;e++)this.loadImage(t[e])},loadImage:function(t){var e=this,n=new FileReader;n.onload=function(n){e.rawImageList.push({src:n.target.result,file:t,key:e.generateImageKey()})},n.readAsDataURL(t)},generateImageKey:function(){return null==this.imageKey&&(this.imageKey=0),this.imageKey++},removeImage:function(t){this.rawImageList.splice(t,1)},uploadImages:function(){var t=this;this.isUploading=!0,ft(this.checkedFriend.id,this.rawImageList.map(function(t){return t.file})).then(function(e){t.isUploading=!1,t.attachments=e.map(function(t){return t.data}).join(","),t.sendImpl(),console.log(e)}).catch(function(e){t.isUploading=!1,console.log(e),p(t,e)})},viewImage:function(t){window.open().document.write('<iframe src="'+t+'" frameborder="0" style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;" allowfullscreen></iframe>')}}},gn=mn,wn=(n("7ad6"),n("f642"),Object(Lt["a"])(gn,$e,Ze,!1,null,"38ecb7a4",null)),bn=wn.exports,kn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.stat?n("div",{staticClass:"modal"},[n("div",{staticClass:"stat-info-content"},[n("div",{staticClass:"stat-header"},[n("span",[t._v(t._s(t.stat.name))]),n("span",{staticClass:"el-icon-close",attrs:{title:"关闭"},on:{click:function(e){return t.close()}}})]),n("div",{staticClass:"stat-content"},[n("div",{staticClass:"stat-detail"},[n("div",[t._v("\n          "+t._s(t.stat.firstLetter.dateStr)+"这一天"+t._s(t.stat.firstLetter.from)+"给"+t._s(t.stat.firstLetter.to)+"写了第一封信\n        ")]),n("div",[t._v("\n          距离现在已有"),n("span",[t._v(t._s(t.stat.totalDays)+"天了")])]),n("div",[t._v("\n          你们一共写了"+t._s(t.stat.totalCount)+"封信，包含整整"+t._s(t.stat.totalWordCount)+"个字\n        ")]),n("div",[t._v("\n          你给“"+t._s(t.stat.name)+"”写了"+t._s(t.stat.totalToCount)+"封信，包含"+t._s(t.stat.totalToWordCount)+"个字\n        ")]),n("div",[t._v("\n          “"+t._s(t.stat.name)+"”给你写了"+t._s(t.stat.totalFromCount)+"封信，包含"+t._s(t.stat.totalFromWordCount)+"个字\n        ")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.stat.perday.count>2,expression:"stat.perday.count > 2"}]},[t._v("\n          特别的，在"+t._s(t.stat.perday.dateStr)+"这天，你们往来了"+t._s(t.stat.perday.count)+"封信\n        ")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.stat.sinLastDays>1,expression:"stat.sinLastDays > 1"}]},[t._v("你们有"+t._s(t.stat.sinLastDays)+"天没有联系了")])]),n("div",{staticClass:"date-map-section"},[t._m(0),n("span",{staticClass:"hover-text",class:{hide:t.hideDateStr}},[t._v(t._s(t.hoverDateStr))]),n("div",{attrs:{id:"svg-container"}})])])])]):t._e()},Cn=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"svg-info"},[n("span",{staticClass:"from"},[t._v("来")]),n("span",{staticClass:"to"},[t._v("往")])])}],Ln=n("1929"),yn=n.n(Ln),_n=["#C6E2FF","#3296FC","#036CD9"],xn=["#C9ECB4","#86D666","#11AE2B"];function Sn(t){return t-1>2?2:t-1}function An(t,e,n){var a=n.onHover,i=n.onClick,s=22,r=48,o=16,c=On(e),l=300;if(c.length>1){var u=c[0].date,h=c[c.length-1].date,d=C(u,h);l=(d/7+3)*o+s}var f=yn()(t).size(l,168),p=new Date,v=In(p),m=6,g=0,w=new Date(c[0].date.valueOf()),b=0,L=-1,y=-1;while(b<c.length){var _=c[b],x=_.date,S=In(x),A=k(w),M=In(w),I=M-S,O=["#F7F7F7"];if(0==I)(0!=b||_.num>0)&&(O=_.fromNum>0&&_.toNum>0?[_n[Sn(_.fromNum)],xn[Sn(_.toNum)]]:_.fromNum>0?[_n[Sn(_.fromNum)]]:[xn[Sn(_.toNum)]]),b++;else if(I<0){console.log("order is wrong");break}var F=s+g*o,j=r+m*o,E=f.group().transform({x:F,y:j});if(1==O.length){var D=f.rect(o-2,o-2).attr({fill:O[0]}).radius(4);E.add(D),v==M&&E.add(f.rect(o,o).attr({fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0.70)",x:-1,y:-1}).radius(4))}else{var T=f.path("M0 7 V4 Q0 0 4 0 H10 Q14 0 14 4 V7 Z").attr({fill:O[0],"stroke-width":0}),V=f.path("M0 7 V10 Q0 14 4 14 H10 Q14 14 14 10 V7 Z").attr({fill:O[1],"stroke-width":0}),N=f.rect(o-2,o-2).attr({fill:"rgba(0,0,0,0)"}).radius(4);E.add(T),E.add(V),E.add(N),v==M&&E.add(f.rect(o,o).attr({fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0.70)",x:-1,y:-1}).radius(4))}E.dateStr=A,E.fromNum=_.fromNum,E.toNum=_.toNum,E.mouseover(function(){a&&a(this.dateStr,this.fromNum,this.toNum),this.stroke({color:"rgba(0,0,0,0.3)"})}),E.mouseout(function(){a&&a(""),this.stroke({color:"rgba(0,0,0,0)"})}),E.click(function(){i&&i(this.dateStr)}),(L<0||L!=w.getFullYear())&&f.text(function(t){t.tspan("".concat(w.getFullYear(),"年")).dy(0)}).font({fill:p.getFullYear()==w.getFullYear()?"rgba(0,0,0, 0.9)":"#ccc",size:15}).attr("x",F).attr("y",10).attr("dominant-baseline","hanging"),L=w.getFullYear(),(y<0||y!=w.getMonth())&&100*w.getFullYear()+w.getMonth()<=100*p.getFullYear()+p.getMonth()&&f.text(function(t){t.tspan("".concat(w.getMonth()+1,"月")).dy(0)}).font({fill:p.getMonth()==w.getMonth()&&p.getFullYear()==w.getFullYear()?"rgba(0,0,0, 0.9)":"#ccc",size:11}).attr("x",F).attr("y",31).attr("dominant-baseline","hanging"),y=w.getMonth(),w.setDate(w.getDate()-1),m--,-1==m&&(m=6,g++)}var R=["日","二","四","六"];R.forEach(function(t,e){f.text(t).font({fill:"rgba(0,0,0,0.25)",size:8}).attr("x",10).attr("y",51+32*e)})}function Mn(t,e){return In(t)-In(e)}function In(t){return 1e4*t.getFullYear()+100*t.getMonth()+t.getDate()}function On(t){var e=P();t.sort(function(t,e){return e.deliver_at?e.deliver_at.localeCompare(t.deliver_at):1});for(var n,a,i=[],s=0;s<t.length;s++){var r=t[s];if(r.deliver_at){var o=w(x(r.deliver_at)),c=r.user!=e.id;n&&0==Mn(n,o)?(a.num++,c?a.fromNum++:a.toNum++):(a={date:o,num:1,fromNum:c?1:0,toNum:c?0:1},i.push(a)),n=o}}var l=Fn();return i.splice(0,0,{date:l,num:0}),i}function Fn(){var t=new Date,e=new Date(t.getFullYear(),t.getMonth()+1,0),n=e.getDay(),a=6-n;return e.addDays(a)}var jn={data:function(){return{cellDataList:[],stat:null,account:P(),hoverDateStr:"",hideDateStr:!1}},methods:{close:function(){this.stat=null},showStat:function(t,e){for(var n=this,a={name:t.name,firstLetter:{},lastLetter:{},totalDays:0,perday:{count:0,dateStr:""},totalCount:0,totalWordCount:0,totalFromCount:0,totalFromWordCount:0,totalToCount:0,totalToWordCount:0},i={},s=0;s<e.length;s++){var r=e[s],o=r.user==this.account.id,c=S(r.body);a.totalCount++,a.totalWordCount+=c,o?(a.totalToCount++,a.totalToWordCount+=c):(a.totalFromCount++,a.totalFromWordCount+=c);var l=w(x(r.deliver_at)),u=b(l),h=u.substring(0,10);s==e.length-1&&(a.firstLetter.dateStr=h,a.firstLetter.date=l,o?(a.firstLetter.from="你",a.firstLetter.to="“".concat(t.name,"”")):(a.firstLetter.from="“".concat(t.name,"”"),a.firstLetter.to="你")),0==s&&(a.lastLetter.date=l),null==i.dateStr?(i.dateStr=h,i.count=1):i.dateStr==h?i.count++:((!a.perday.dateStr||i.count>a.perday.count)&&(a.perday.dateStr=i.dateStr,a.perday.count=i.count),i.dateStr=h,i.count=1)}a.totalDays=C(new Date,a.firstLetter.date),a.sinLastDays=C(new Date,a.lastLetter.date),this.stat=a,this.$nextTick(function(){An("svg-container",e,{onHover:function(t,e,a){t?(Object(nn["clearTimeout"])(n.dateTimeoutId),n.hideDateStr=!1,n.hoverDateStr="".concat(t," 来").concat(e||0," 往").concat(a||0)):n.dateTimeoutId=Object(nn["setTimeout"])(function(){n.hideDateStr=!0,n.dateTimeoutId=Object(nn["setTimeout"])(function(){n.hoverDateStr=""},300)},500)},onClick:function(t){n.close(),n.$emit("scrollToDate",t)}})})}}},En=jn,Dn=(n("0adb"),Object(Lt["a"])(En,kn,Cn,!1,null,"7a75a3c2",null)),Tn=Dn.exports,Vn=n("a0a7"),Nn=n.n(Vn),Rn=n("57e5"),Bn=n.n(Rn),qn={components:{NewLetter:bn,Stat:Tn,LetterItem:vn},computed:Object(At["a"])({},Object(Mt["c"])(["checkedFriend","searchValue","mobileMode"]),{attachments:function(){var t=this.checkedLetter;return t&&t.attachments?t.attachments.split(",").map(function(t){return ht(t)}):null},icLetterInOut:function(){return[Bn.a,Nn.a]},renderLetters:function(){var t=this,e=this.listRender.renderedList(),n=new RegExp(this.searchValue,"g"),a=this.searchValue?e.filter(function(e){var a=Object(ke["a"])(ze()(e.body,n));if(0==a.length)return!1;for(var i="",s=-1,r=Math.min(a.length,5),o=0;o<r;o++){var c=6,l=a[o],u=s+1;l.index-u>c&&(i+="...",u=l.index-c),i+=e.body.substr(u,l.index-u)+t.searchValue;var h=l.index+t.searchValue.length+c;if(r-1>o){var d=a[o+1];h=Math.min(d.index-1,h)}i+=e.body.substring(l.index+t.searchValue.length,h+1),s=h,r-1==o&&i.length<150&&(i+=e.body.substr(s,150-i.length))}return e.searchHtml=i.split(t.searchValue).join('<span style="color: red">'+t.searchValue+"</span>"),!0}):e,i=this.searchValue;if(this.checkedLetter){for(var s=-1,r=0;r<a.length;r++)if(a[r].id==this.checkedLetter.id){s=r;break}s<0?this.checkedLetter=null:i!=this.lastSearchText&&this.$nextTick(function(){t.scorllToIndex(s)})}return this.lastSearchText=i,a},checkedFriendInfo:function(){if(this.checkedFriend){var t=[];t.push(["姓名",this.checkedFriend.name]),t.push(["生日",this.checkedFriend.dob||"保密"]);var e=this.checkedFriend.location_code,n=Ye["countries"][e];return t.push(["位置",n&&n.name||e]),this.checkedFriend.latest_comment&&t.push(["回复时间",g(this.checkedFriend.latest_comment)]),this.checkedFriend.last_login&&t.push(["登录时间",g(this.checkedFriend.last_login)]),t.map(function(t){return t.join("：")}).join("\n")}return""},searchNav:function(){return this.checkedFriend&&this.searchValue&&this.refs.letterItem?{show:!0}:{show:!1}}}),watch:{checkedFriend:function(t,e){!t||t&&e&&t.id==e.id||(this.letters=[],this.loadLetters(t),this.checkedLetter=null,De(this,".letter-list"))}},data:function(){return{letters:[],mapVisible:!1,map:null,letterState:"",showSyncIcon:!1,checkedLetter:null,checkedLetterIndex:-1,account:P(),highlightDate:null,listRender:Re({preloadCount:25})}},methods:Object(At["a"])({},Object(Mt["b"])(["checkFriend"]),{showFriendInfo:function(){this.$createElement;this.$message({dangerouslyUseHTMLString:!0,message:this.checkedFriendInfo,duration:1e4,showClose:!0,customClass:"dialog-friend-info"})},loadLetters:function(t){var e=this;Fe(t).setCallback(function(t,n){var a=n.isRefresh,i=n.isSync,s=n.dataList,r=n.isSuccess;if(t.userId==e.checkedFriend.id&&(i?(e.showSyncIcon=!1,e.letterState="正在同步第".concat(t.syncPage,"页")):a?(e.letterState=null,e.showSyncIcon=!0):(e.showSyncIcon=!1,e.letterState=null,r||p(e,"同步失败，请检查网络或重新登录")),0==e.letters.length&&e.listRender.optimise(),e.letters=s,e.listRender.dataList=e.letters,e.checkedFriend.letters=s,e.checkedLetter))for(var o=0;o<s.length;o++)if(s[o].id==e.checkedLetter.id){e.checkLetter(s[o],o,!0);break}}).requestData()},newLetter:function(){this.$refs.newLetter.showEditor()},checkLetter:function(t,e,n){this.checkedLetter=t,this.checkedLetterIndex=e,n||De(this,".right-section .scroll-container"),t.read_at||this.isLetterOut(t)||!this.isLetterArrive(t)||vt(t.id).then(function(t){}).catch(function(t){console.log(t)})},formatReadableTime:function(t){return L(w(t))},showStat:function(){0==this.letters.length?m(this,"没有信件"):this.$refs.stat.showStat(this.checkedFriend,this.letters)},isLetterArrive:function(t){return w(t.deliver_at)<Ot()()},isLetterOut:function(t){return t.user==this.account.id},lastLetter:function(){this.checkLetter(this.renderLetters[this.checkedLetterIndex-1],this.checkedLetterIndex-1)},nextLetter:function(){this.checkLetter(this.renderLetters[this.checkedLetterIndex+1],this.checkedLetterIndex+1)},scrollToDate:function(t){var e=this,n=-1,a=!1;this.renderLetters.forEach(function(e){var i=k(w(e.deliver_at));a||(i==t&&(a=!0),n++),e.highlight=i==t}),this.highlightDate=t;var i=this.$el.querySelector(".letter-list");a&&this.scorllToIndex(n),Te(i,function(){setTimeout(function(){e.highlightDate=null},2e3)})},scorllToIndex:function(t,e){e||(e=this.$el.querySelector(".letter-list")),e&&e.children&&e.children.length>t&&(e.scrollTop=e.children[t].offsetTop)},closeLetters:function(){this.checkFriend(null)},doExport:function(){Ve(this.checkedFriend,this.letters)}})},Pn=qn,Gn=(n("97aa"),n("e266"),Object(Lt["a"])(Pn,Ue,We,!1,null,"9c8ca634",null)),Qn=Gn.exports,Hn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"input-container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"input",class:{"has-content":t.content},attrs:{spellcheck:"false"},domProps:{value:t.content},on:{focus:function(e){t.inputFocus=!0},blur:function(e){t.inputFocus=!1},input:function(e){e.target.composing||(t.content=e.target.value)}}}),!t.checkedFriend||t.content||t.inputFocus?t._e():n("span",{staticClass:"placeholder"},[t._v("\n    搜索"),n("span",{staticClass:"name"},[t._v(t._s(t.checkedFriend.name))]),t._v("的信...\n  ")]),n("i",{staticClass:"el-icon-search"}),n("i",{directives:[{name:"show",rawName:"v-show",value:t.searchValue,expression:"searchValue"}],staticClass:"el-icon-close",on:{click:t.clear}})])},Un=[],Wn={data:function(){return{content:"",inputFocus:!1}},computed:Object(At["a"])({},Object(Mt["c"])(["searchValue","checkedFriend"])),watch:{content:function(t){this.setSearchValue(t)}},methods:Object(At["a"])({},Object(Mt["b"])(["setSearchValue"]),{clear:function(){this.content=""}})},Xn=Wn,zn=(n("c9a1"),Object(Lt["a"])(Xn,Hn,Un,!1,null,"e491a454",null)),Yn=zn.exports,$n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"no-scroll-bar"},[n("div",{staticClass:"quote-section",on:{click:t.changeQuote}},[t.currentQuote?n("div",{staticClass:"quote-item"},[n("div",{staticClass:"content"},[t._v(t._s(t.currentQuote.content))]),n("div",{staticClass:"author"},[t._v(t._s(t.currentQuote.quoteInfo))])]):t._e()])])},Zn=[],Jn={data:function(){return{quotes:[],currentQuote:null}},methods:{getQuoteInfo:function(t){var e=t.ref_name||t.au_name,n=t.ref_name?t.au_name:"";return e?"——".concat(e).concat(n?" · ":"").concat(n):""},changeQuote:function(){var t=this.quotes[J()(Math.random()*this.quotes.length)];this.currentQuote={content:t.content,quoteInfo:this.getQuoteInfo(t)}},fetchQuotes:function(){var t=this;V()({method:"get",url:"./quotes.json"}).then(function(e){e.data&&e.data.length>0&&(t.quotes=e.data,t.changeQuote())}).catch(function(t){console.log(t)})}},mounted:function(){this.fetchQuotes()}},Kn=Jn,ta=(n("dc67"),Object(Lt["a"])(Kn,$n,Zn,!1,null,"957e0bc2",null)),ea=ta.exports,na=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.mapVisible?n("div",{staticClass:"modal"},[t._m(0),n("el-button",{staticClass:"btn-close",attrs:{type:"primary",icon:"el-icon-close",circle:"",title:"关闭地图"},on:{click:function(e){t.mapVisible=!1}}}),n("el-button",{staticClass:"btn-update-location",attrs:{type:"primary",icon:"el-icon-edit",title:"更新为选中的位置",circle:""},on:{click:t.updateToSelectLocation}}),t._e()],1):t._e()},aa=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"map-wrapper"},[n("div",{attrs:{id:"map"}})])}],ia=n("59ad"),sa=n.n(ia),ra=function(){function t(){}return t.wgs2gcj=function(e,n){if(t.outOfChina(e,n))return[e,n];var a=t.delta(e,n);return[e+a[0],n+a[1]]},t.wgs2bd=function(e,n){if(t.outOfChina(e,n))return[e,n];var a=t.wgs2gcj(e,n),i=t.gcj2bd(a[0],a[1]);return i},t.gcj2wgs=function(e,n){if(t.outOfChina(e,n))return[e,n];var a=t.delta(e,n);return[e-a[0],n-a[1]]},t.gcj2bd=function(e,n){var a=Math.sqrt(n*n+e*e)+2e-5*Math.sin(e*t.x_pi),i=Math.atan2(e,n)+3e-6*Math.cos(n*t.x_pi),s=a*Math.cos(i)+.0065,r=a*Math.sin(i)+.006;return[r,s]},t.bd2wgs=function(e,n){var a=t.bd2gcj(e,n),i=t.gcj2wgs(a[0],a[1]);return i},t.bd2gcj=function(e,n){var a=n-.0065,i=e-.006,s=Math.sqrt(a*a+i*i)-2e-5*Math.sin(i*t.x_pi),r=Math.atan2(i,a)-3e-6*Math.cos(a*t.x_pi),o=s*Math.cos(r),c=s*Math.sin(r);return[c,o]},t.distance=function(t,e,n,a){var i=6371e3,s=Math.cos(3.141592653589793*t/180)*Math.cos(3.141592653589793*n/180)*Math.cos(3.141592653589793*(e-a)/180),r=Math.sin(3.141592653589793*t/180)*Math.sin(3.141592653589793*n/180),o=s+r;o>1&&(o=1),o<-1&&(o=-1);var c=Math.acos(o),l=c*i;return l},t.outOfChina=function(t,e){return!(e>=72.004&&e<=137.8347)||(t<.8293||t>55.8271)},t.delta=function(e,n){var a=6378245,i=.006693421622965943,s=t.transformLat(n-105,e-35),r=t.transformLon(n-105,e-35),o=e/180*t.pi,c=Math.sin(o);c=1-i*c*c;var l=Math.sqrt(c);return s=180*s/(a*(1-i)/(c*l)*t.pi),r=180*r/(a/l*Math.cos(o)*t.pi),[s,r]},t.transformLat=function(e,n){var a=2*e-100+3*n+.2*n*n+.1*e*n+.2*Math.sqrt(Math.abs(e));return a+=2*(20*Math.sin(6*e*t.pi)+20*Math.sin(2*e*t.pi))/3,a+=2*(20*Math.sin(n*t.pi)+40*Math.sin(n/3*t.pi))/3,a+=2*(160*Math.sin(n/12*t.pi)+320*Math.sin(n*t.pi/30))/3,a},t.transformLon=function(e,n){var a=300+e+2*n+.1*e*e+.1*e*n+.1*Math.sqrt(Math.abs(e));return a+=2*(20*Math.sin(6*e*t.pi)+20*Math.sin(2*e*t.pi))/3,a+=2*(20*Math.sin(e*t.pi)+40*Math.sin(e/3*t.pi))/3,a+=2*(150*Math.sin(e/12*t.pi)+300*Math.sin(e/30*t.pi))/3,a},t.mercator2LatLon=function(t,e){var n=t/20037508.34*180,a=e/20037508.34*180;a=57.29577951308232*(2*Math.atan(Math.exp(3.141592653589793*a/180))-1.5707963267948966);var i=[a,n];return i},t.latLon2Mercator=function(t,e){var n=20037508.34*e/180,a=Math.log(Math.tan(3.141592653589793*(90+t)/360))/.017453292519943295;return a=20037508.34*a/180,[n,a]},t}();function oa(t,e){return ra.bd2wgs(t,e)}function ca(t,e){return ra.wgs2bd(t,e)}ra.pi=3.141592653589793,ra.a=6378245,ra.ee=.006693421622965943,ra.x_pi=52.35987755982988,ra["__class"]="LocationUtil";var la={data:function(){return{map:null,mapVisible:!1}},methods:{editLocation:function(){P()?P().location?this.showGpsLocationStr(P().location):(p(this,"当前账户坐标信息不存在"),this.showGpsLocation(0,0)):p(this,"账户不存在")},onMapClick:function(t){console.log(t.point),this.removeOverlays(),this.addMarker(t.point,!1)},showMap:function(t){this.showGpsLocationStr(t.user_location)},showGpsLocationStr:function(t){var e=t.split(",");this.showGpsLocation(sa()(e[0]),sa()(e[1]))},showGpsLocation:function(t,e){var n=this;this.initMap().then(function(){n.removeOverlays();var a=ca(t,e);n.addMarker(new BMap.Point(a[1],a[0]),!0)})},initMap:function(){var t=this;return this.mapVisible=!0,new O.a(function(e){t.$nextTick(function(){t.map=new BMap.Map("map"),t.map.enableScrollWheelZoom(!0),t.map.addEventListener("click",function(e){t.onMapClick(e)}),e(t.map)})})},addMarker:function(t,e){var n=this,a=new BMap.Marker(t);a.slowly=!0,this.map.addOverlay(a),e&&(this.map.centerAndZoom(t,15),window.setTimeout(function(){n.map.panTo(t)},100))},removeOverlays:function(){for(var t=this.map.getOverlays(),e=t.length-1;e>=0;e--)this.map.removeOverlay(t[e])},updateToSelectLocation:function(){for(var t=this,e=this.map.getOverlays(),n=null,a=e.length-1;a>=0;a--)if(e[a].slowly){n=e[a];break}if(n){var i=oa(n.point.lat,n.point.lng);this.$confirm("确定修改位置？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){return lt(i[0],i[1]).then(function(){var e=P();e.location="".concat(i[0],",").concat(i[1]),G(e),v(t,"修改成功")})}).catch(function(e){e.message?p(t,e.message):"cancel"!=e&&p(t,"修改位置失败："+e)})}else p(this,"未选中点")},locate:function(){var t=this;"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){t.showGpsLocation(e.coords.latitude,e.coords.longitude)},function(t){console.log(t)}):console.log("Location is not avaiable")}}},ua=la,ha=(n("abea"),n("13b2"),Object(Lt["a"])(ua,na,aa,!1,null,"b5844e68",null)),da=ha.exports,fa=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.visible?n("div",{staticClass:"modal",on:{click:function(e){t.visible=!1}}},[n("div",{staticClass:"content soft-scrollable"},[t.changeLog?t._l(t.changeLog,function(e){return n("div",{key:e.versionCode},[n("div",{staticClass:"version-name"},[t._v("\n          "+t._s(e.versionName)+"\n        ")]),n("ul",{staticClass:"version-content"},t._l(e.contentItems,function(e){return n("li",{key:e},[n("span",[t._v(t._s(e))])])}),0)])}):n("div",[t._v("\n      正在加载...\n    ")])],2)]):t._e()},pa=[],va={data:function(){return{visible:!1}},computed:Object(At["a"])({},Object(Mt["c"])(["changeLog"])),methods:{show:function(){this.visible=!0},hide:function(){this.visible=!1}}},ma=va,ga=(n("0be8"),Object(Lt["a"])(ma,fa,pa,!1,null,"7f584ab8",null)),wa=ga.exports,ba=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.visible?n("div",{staticClass:"modal",on:{click:function(e){t.visible=!1}}},[n("div",{staticClass:"content soft-scrollable"},[t._v("\n    子夜的灯\n    是一条未穿衣裳的\n    小河\n       \n    你的信像一尾鱼游来\n    读水的温暖\n    读你额上动人的鳞片\n       \n    读江河如读一面镜\n    读镜中你的笑\n    如读泡沫\n\n    — 子夜读信·洛夫\n  ")])]):t._e()},ka=[],Ca={data:function(){return{visible:!1}},methods:{show:function(){this.visible=!0},hide:function(){this.visible=!1}}},La=Ca,ya=(n("a6d9"),Object(Lt["a"])(La,ba,ka,!1,null,"8141b2d8",null)),_a=ya.exports,xa={data:function(){return{accountInfo:null,leftSectionExited:!0}},components:{Friends:He,Letters:Qn,"map-node":da,InputBox:Yn,"quote-node":ea,About:_a,ChangeLog:wa,Version:Qt},computed:Object(At["a"])({},Object(Mt["c"])(["checkedFriend","friendList","mobileMode"])),methods:Object(At["a"])({},Object(Mt["b"])(["setFriends"]),{exit:function(){var t=this;this.$confirm("退出后数据仍在，是否确定退出?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){Q(),t.goLogin()}).catch(function(){})},goLogin:function(){this.$router.replace({name:"login"})},showMap:function(t){this.$refs.map.showMap(t)},loadFriends:function(){var t=this,e=function(){st().then(function(e){var n=e.data;t.setFriends(Ee(n.friends)),be(t.friendList)}).catch(function(e){return t.$errorHandler(e)})};we().then(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.setFriends(Ee(n)),0!=n.length&&__CONFIG__.useCache||e()}).catch(function(){e()})},editLocation:function(){this.$refs.map.editLocation()},showAbout:function(){this.$refs.about.show()},showChangeLog:function(){this.$refs.changeLog.show()}}),watch:{checkedFriend:function(t){this.mobileMode&&(this.leftSectionExited=!0)},mobileMode:function(){this.mobileMode||(this.leftSectionExited=!1)}},mounted:function(){var t=this;B()?(this.leftSectionExited=this.mobileMode,this.accountInfo=P(),this.accountInfo?(this.loadFriends(),ot().then(function(t){G(t.data)}).catch(function(t){console.log(t)})):ot().then(function(e){t.accountInfo=e.data,G(t.accountInfo),t.loadFriends()}).catch(function(t){return console.log(t)})):this.goLogin()}},Sa=xa,Aa=(n("245e"),Object(Lt["a"])(Sa,zt,Yt,!1,null,"acfd7ada",null)),Ma=Aa.exports,Ia=n("e166"),Oa=n.n(Ia),Fa=n("caf9");a["default"].use(Mt["a"]);var ja=new Mt["a"].Store({state:{checkedFriend:null,friendList:[],searchValue:"",mobileMode:!1,changeLog:null},mutations:{setFriends:function(t,e){t.friendList=e},checkFriend:function(t,e){t.checkedFriend=e},setSearchValue:function(t,e){t.searchValue=e},setMobileMode:function(t,e){t.mobileMode=e},setChangeLog:function(t,e){t.changeLog=e}}});function Ea(){ja.commit("setMobileMode",window.innerWidth<=850)}if(Ea(),window.addEventListener("resize",Ea),!Bt()){a["default"].use(u.a),a["default"].use(c["a"]),a["default"].use(Oa.a),a["default"].use(Fa["a"]),a["default"].config.productionTip=!1;var Da=new URL(window.location.href),Ta=Da.searchParams.get("token");Ta&&q(Ta),window.__CONFIG__={useCache:!1},a["default"].prototype.$errorHandler=function(t){var e=t.message,n=t.exitLogin;p(this,e),("token_expired"==e||"token_invalid"==e||n)&&(q(""),this.$router.replace({name:"login"}))};var Va=[{path:"/login",name:"login",component:Xt},{path:"/home",name:"home",component:Ma},{path:"/",redirect:"/home"}],Na=new c["a"]({routes:Va});new a["default"]({router:Na,store:ja}).$mount("#app")}},"57e5":function(t,e,n){t.exports=n.p+"img/ic_mail_in.25717605.png"},"62ee":function(t,e,n){},"63ef":function(t,e,n){},"65ef":function(t,e,n){},"675e":function(t,e,n){"use strict";var a=n("63ef"),i=n.n(a);i.a},"6eec":function(t,e,n){},"7ad6":function(t,e,n){"use strict";var a=n("3340"),i=n.n(a);i.a},"84aa":function(t,e,n){},"90ae":function(t,e,n){},9407:function(t,e,n){},"97aa":function(t,e,n){"use strict";var a=n("fdbf"),i=n.n(a);i.a},"9ce7":function(t,e,n){"use strict";var a=n("bd4b"),i=n.n(a);i.a},"9ded":function(t,e,n){"use strict";var a=n("29f8"),i=n.n(a);i.a},a0a7:function(t,e,n){t.exports=n.p+"img/ic_mail_out.59b2d671.png"},a39b:function(t,e,n){"use strict";var a=n("62ee"),i=n.n(a);i.a},a6d9:function(t,e,n){"use strict";var a=n("6eec"),i=n.n(a);i.a},aa58:function(t,e,n){},abea:function(t,e,n){"use strict";var a=n("90ae"),i=n.n(a);i.a},aeb8:function(t,e,n){t.exports=n.p+"img/pen.f92c60b9.png"},b84f:function(t,e){t.exports="data:image/png;base64,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"},bd24:function(t,e,n){},bd4b:function(t,e,n){},c9a1:function(t,e,n){"use strict";var a=n("f768"),i=n.n(a);i.a},d41d:function(t,e,n){},d6de:function(t,e,n){"use strict";var a=n("aa58"),i=n.n(a);i.a},dc67:function(t,e,n){"use strict";var a=n("bd24"),i=n.n(a);i.a},e266:function(t,e,n){"use strict";var a=n("84aa"),i=n.n(a);i.a},eb33:function(t,e,n){"use strict";var a=n("5372"),i=n.n(a);i.a},f182:function(t,e,n){t.exports=n.p+"img/ic_logo.53d14635.svg"},f642:function(t,e,n){"use strict";var a=n("9407"),i=n.n(a);i.a},f768:function(t,e,n){},fdbf:function(t,e,n){},ff11:function(t,e,n){}});
//# sourceMappingURL=app.09ffe1b7.js.map